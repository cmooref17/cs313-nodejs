<!DOCTYPE html>

<head>
   <link rel="stylesheet" href="/stylesheets/myCss.css">
   <title>My webpage</title>
   
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   
   <script>
      function setBackgroundSize() {
         var load = true;
         if(load) {
            var w = window.innerWidth;
            var h = window.innerHeight;
            var size = w + "px " + h + "px";
            var body = document.getElementById('body');
            body.style.backgroundImage = "url(/images/background.jpg)";
            body.style.backgroundSize = size;
         }
      }
      
      function redeemGift(data) {
         console.log("Redeeming gift");
         var giftNumber = data.id;
         console.log("Gift number: " + giftNumber);
         var json = {giftNumber: giftNumber,
                     numGifts: data.numGifts};
         $.post("/redeem", json, function(data, status) {
            if(data != '-1' && data != '-2') {
               console.log(data);
               document.getElementById("gift" + giftNumber).remove();
               if(data.numGifts == 0)
                  document.getElementById("giftStatus").innerHTML = "You are out of daily gifts";
            }
         });
      }
      
      function showGift(id, numGift) {
         giftStatus = document.getElementById("giftStatus");
         var gifts = document.getElementById("gifts");
         console.log("Showing item with id: " + id);
         $.get("/getGift?id=" + id, function(data, status) {
            if(data == '-1')
               console.log("Bad item");
            else {
               console.log(data.id);
               var color;
               var rarity;
               if(data.rarity == 0) {
                  color = "green";
                  rarity = "common";
               }
               else if(data.rarity == 1) {
                  color = "blue";
                  rarity = "uncommon";
               }
               else if(data.rarity == 2) {
                  color = "purple";
                  rarity = "rare";
               }
               else if(data.rarity == 3) {
                  color = "orange";
                  rarity = "ultra rare";
               }
               gifts.innerHTML += "<div style='background-color: " + color + "' id='gift" + numGift + "' class='gift'></div>";
               var giftDiv = document.getElementById('gift' + numGift);
               
               if(data.set == null) {//bells
                  giftDiv.innerHTML = "<header style='text-align: center; font-style: 25px; color: yellow'>" + data.name + "</header>";
                  giftDiv.innerHTML += "<img class='giftImg' style='width: 75%; height: 75%' src='" + data.imgUrl + "'><br>";
                  giftDiv.innerHTML += "<button type='button' class='redeem' id='" + numGift + "' onclick='redeemGift(this)'>Redeem " + data.sellPrice + " bells</button>";
               } else {
                  giftDiv.innerHTML = "<header style='text-align: center; font-style: 25px; color: yellow'>" + data.name + "</header>";
                  giftDiv.innerHTML += "<img class='giftImg' src='" + data.imgUrl + "'><br>";
                  giftDiv.innerHTML += "<header>Set: <span style='position: absolute; right:16px'>" + data.set + "</span></header>";
                  giftDiv.innerHTML += "<header>Buy price: <span style='position: absolute; right:16px'>" + data.buyPrice + " bells</span></header>";
                  giftDiv.innerHTML += "<header>Sell price: <span style='position: absolute; right:16px'>" + data.sellPrice + " bells</span></header>";
                  giftDiv.innerHTML += "<button type='button' class='redeem' id='" + numGift + "' onclick='redeemGift(this)'>Redeem item</button>";
               }
            }
         });
      }
      
      function drawPage() {
         var right = document.getElementById("rightSign");
         var gifts = document.getElementById("gifts");
         giftStatus = document.getElementById("giftStatus");
         
         $.get("/getSession", function(data, status) {
            if(data == '-1' || data == '-2') {
               right.innerHTML = "<header class='promptLogin'>You are not logged in<br><a href='login.html' class='promptLogin' style='color: white'>Login</a></header>";
               giftStatus.innerHTML = "You are not logged in";
            }
            else {
               right.innerHTML = "<header class='promptLogin welcome'>Welcome " + data.username + "!<br>" + data.bells + " bells</header>";
               
               if(data.numGifts > 0) {
                  giftStatus.innerHTML = "Your free gifts for today!<hr style='margin-left: 16px; margin-right: 16px'>";
                  
                  console.log(data.item0);
                  console.log(data.item1);
                  console.log(data.item2);
                  console.log(data.item3);
                  if(data.item0 != -1) {
                     showGift(data.item0, 0);
                  }
                  if(data.item1 != -1) {
                     showGift(data.item1, 1);
                  }
                  if(data.item2 != -1) {
                     showGift(data.item2, 2);
                  }
                  if(data.item3 != -1) {
                     showGift(data.item3, 3);
                  }
                  
                  gifts.innerHTML += "<br>";
               }
               else {
                  giftStatus.innerHTML = "You are out of daily gifts";
               }
            }
         });
      }
      
  
   </script>
   
</head>

<body onresize="setBackgroundSize()" onload="setBackgroundSize()" id="body">

   <div style="height: 250px"> <!-- Header --->
      <div id="leftSign" class="leftSign">
         <header class="leftSignText">Trading<br>Outpost</header>
      </div>
      <div id="rightSign" class="rightSign">
         
   </div></div>
   
   
   
   <!-- Two divs to wrap content and center it --->
   <div id="outerDiv" class="outerGifts" style="text-align: center"><header class='giftStatus' id='giftStatus'></header><div id="gifts" class="gifts">
      
   </div></div>
   
   <script type="text/javascript">
      drawPage();
   </script>
   
</body>
</html>