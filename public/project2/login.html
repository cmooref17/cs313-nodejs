<!DOCTYPE html>

<head>
   <link rel="stylesheet" href="/stylesheets/login.css">
   <title>Login</title>
   
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   
   <script>
      signUp = false;
      minPasswordLength = 8;
      
      function validatePassword() {
        /*
         var password = document.getElementById("password1").value;
         var password2 = document.getElementById("password2").value;
         if(password != password2) {
            return -1;
         }
         else {
            //Iterate through password
            var i = 0;
            bool hasUppercase = false;
            while(password[i]) {
               if(password[i])
                  hasUppercase = true;
            }
            if(!hasUppercase)
               return -2;
            else if(i < minPasswordLength)
               return -3;
            */
            return 1;
         }
      
      function signIn() {
         var username = document.getElementById("username").value;
         var password = document.getElementById("password").value;
      
         $.get("/signIn?username=" + username + "&password=" + password, function(data, status){
            alert("Data: " + data + "\nStatus: " + status);
         });
      }
      
      function register() {
         alert("Registering...");
         
         var code = validatePassword();
         if(code < 1) {
            if(code == -1)
               alert("Passwords don't match");
            else if(code == -2)
               alert("Password must have an uppercase");
            else if(code == -3)
               alert("Passwords must be at least " + minPasswordLength + " long.");
            else
               alert("Unknown error in password");
            return false;
         }
         
         var json = {firstName: document.getElementById("firstName").value,
                     lastName: document.getElementById("lastName").value,
                     username: document.getElementById("username").value,
                     password: document.getElementById("password1").value,
                     email: document.getElementById("email").value};
         alert(json);
         $.post("/register", json, function (data, status) {
            alert("Data: " + data + "\nStatus: " + status);
         });
      }

         
      
      
      function setBackgroundSize() {
         var load = true;
         if(load) {
            var w = window.innerWidth;
            var h = window.innerHeight;
            var size = w + "px " + h + "px";
            var body = document.getElementById('body');
            body.style.backgroundImage = "url(/images/background.jpg)";
            body.style.backgroundSize = size;
         }
      }
      
      function drawWindow() {
         var window = document.getElementById("inner");
         if(signUp) {
            document.getElementById("outer").style.width="350px";
            window.innerHTML =  "<form id='formSignUp' method='POST' action='/signUp'>";
            window.innerHTML += "<header style='font-size: 20px; margin: 0px'>Sign up</header><hr>";
            window.innerHTML += "<span class='loginLeft'><header style='margin: 0px'>First name</header></span>";
            window.innerHTML += "<span class='loginRight'><input form='formSignUp' id='firstName' name='firstName' type='text' placeholder='First name'></span><br>";
            window.innerHTML += "<span class='loginLeft'><header style='margin: 0px'>Last name</header></span>";
            window.innerHTML += "<span class='loginRight'><input form='formSignUp' id='lastName' name='lastName' type='text' placeholder='Last name'></span><br>";
            window.innerHTML += "<span class='loginLeft'><header style='margin: 0px'>Username</header></span>";
            window.innerHTML += "<span class='loginRight'><input form='formSignUp' id='username' name='username' type='text' placeholder='Username'></span><br>";
            window.innerHTML += "<span class='loginLeft'><header style='margin: 0px'>Email</header></span>";
            window.innerHTML += "<span class='loginRight'><input form='formSignUp' id='email' name='email' type='text' placeholder='Email'></span><br>";
            window.innerHTML += "<span class='loginLeft'><header style='margin: 0px'>Password</header></span>";
            window.innerHTML += "<span class='loginRight'><input form='formSignUp' id='password1' name='password1' type='password' placeholder='Password'></span><br>";
            window.innerHTML += "<span class='loginLeft'><header style='margin: 0px'>Confirm password</header></span>";
            window.innerHTML += "<span class='loginRight'><input form='formSignUp' id='password2' name='password2' type='password' placeholder='Confirm password'></span><br>";
            window.innerHTML += "</form>";
            window.innerHTML += "<header style='margin: 8px'><button style='width: 120px' onclick='register()'>Create account</button></header>";
            window.innerHTML += "<header class='switchWindow'><a href='#signIn' onclick='changeWindow()'>Already have an account?</a></header>";
         }
         else {
            document.getElementById("outer").style.width="300px";
            window.innerHTML =  "<form id='formSignIn' method='GET' action='/signIn'>";
            window.innerHTML +=  "<header style='font-size: 20px; margin: 0px'>Sign in</header><hr>";
            window.innerHTML += "<span class='loginLeft'><header style='margin: 0px'>Username</header></span>";
            window.innerHTML += "<span class='loginRight'><input form='formSignIn' id='username' name='username' type='text' placeholder='Username'></span><br>";
            window.innerHTML += "<span class='loginLeft'><header style='margin: 0px'>Password</header></span>";
            window.innerHTML += "<span class='loginRight'><input form='formSignIn' id='password' name='password' type='password' placeholder='Password'></span><br>";
            window.innerHTML += "</form>";
            window.innerHTML += "<header style='margin: 8px'><button style='width: 120px' onclick='signIn()'>Login</button></header>";
            window.innerHTML += "<header class='switchWindow'><a href='#signUp' onclick='changeWindow()'>Don't have an account?</a></header>";
         }
      }
      
      function changeWindow() {
         signUp = !signUp;
         drawWindow();
      }
   </script>
   
</head>

<body onresize="setBackgroundSize()" onload="setBackgroundSize()" id="body">
   <div class="leftSign">
      <header class="leftSignText"><a class="toOutpost" href="home.html">Trading<br>Outpost</a></header>
   </div>
   
   <!-- Two divs to wrap content and center it --->
   <div id="outer" class="loginOuter"><div id="inner" class="loginInner">
      <script>
         drawWindow();
      </script>
   </div></div>

</body>

</html>